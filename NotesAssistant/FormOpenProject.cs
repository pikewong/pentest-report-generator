using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.IO;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;

namespace NotesAssistant {
    public partial class FormOpenProject : Form {
        public FormOpenProject() {
            InitializeComponent();
        }

        /// <summary>
        /// Load Project File
        /// Required: Database file
        /// 1. Set Config
        /// 2. Load Database
        /// </summary>
        private void openProjectFile() {
            if (String.IsNullOrEmpty(textBoxBrowse.Text)) {
                labelWarning.ForeColor = System.Drawing.Color.Red;
                labelWarning.Text = @"Please select the Database File!!";
            }
            else {
                Config.DatabasePath = textBoxBrowse.Text;
                Config.ProjectPath = System.IO.Path.GetDirectoryName(Config.DatabasePath);
                Program.Database = new Database.Databaser(Config.ProjectPath);
                Program.Database.loadDatabase();
                MessageBox.Show("Database successfully loaded.");
                Program.state.formStartState = State.FormState.DONE;

                this.Close();
            }
        }

        #region button
        /// <summary>
        /// Select Database File
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void buttonDBPath_Click(object sender, EventArgs e) {
            OpenFileDialog ofd = new OpenFileDialog();
            ofd.Title = "Please select the database file";
            ofd.Filter = "Database (*.db)|*.db";
            if (ofd.ShowDialog() == DialogResult.OK) {
                try {
                    Stream fileStream = ofd.OpenFile();
                    if (fileStream != null) {
                        textBoxBrowse.Text = ofd.FileName;
                        fileStream.Close();
                    }
                }
                catch (Exception ex) {
                    MessageBox.Show("Error: Could not read file from disk. Original error: " + ex.Message);
                }
            }
            ofd.Dispose();
        }

        private void buttonCancel_Click(object sender, EventArgs e) {
            this.Close();
        }

        private void buttonOK_Click(object sender, EventArgs e) {
            openProjectFile();
        }
        #endregion

    }
}
