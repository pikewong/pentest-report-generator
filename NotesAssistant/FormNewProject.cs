using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.IO;
using System.Threading.Tasks;
using System.Windows.Forms;
using Microsoft.WindowsAPICodePack.Dialogs;

namespace NotesAssistant {
    public partial class FormNewProject : Form {
        public FormNewProject() {
            InitializeComponent();
                textBoxBrowse.Enabled = false;
        }

        /// <summary>
        /// Create New Project
        /// Required: Project Time, Project Name, Project Path
        /// 1. Set Config
        /// 2. Create Database
        /// </summary>
        private void createProjectFile() {
            if (String.IsNullOrEmpty(comboBoxProjectTime.Text)) {
                labelWarning.ForeColor = System.Drawing.Color.Red;
                labelWarning.Text = @"Please select the project time!!";
            }
            else if (String.IsNullOrEmpty(textBoxName.Text)) {
                labelWarning.ForeColor = System.Drawing.Color.Red;
                labelWarning.Text = @"Please enter the project name!!";
            }
            else if (String.IsNullOrEmpty(textBoxBrowse.Text)) {
                labelWarning.ForeColor = System.Drawing.Color.Red;
                labelWarning.Text = @"Please select a project path!!";
            }
            else {
                Config.ProjectTime = comboBoxProjectTime.Text;
                Config.ProjectName = textBoxName.Text;
                Config.ProjectPath = textBoxBrowse.Text+ @"\" + Config.ProjectName;

                bool exists = System.IO.Directory.Exists(Config.ProjectPath);

                if (!exists) {
                    System.IO.Directory.CreateDirectory(Config.ProjectPath);
                    Program.Database = new Database.Databaser(Config.ProjectPath);
                    Program.Database.createDatabase();
                    MessageBox.Show("Project successfully created.");
                    Program.state.formStartState = State.FormState.DONE;

                    this.Close();
                }
                else {
                    labelWarning.ForeColor = System.Drawing.Color.Red;
                    labelWarning.Text = @"Project name exist!! Please enter a new project name";
                }
            }
        }

        #region Button
        private void buttonProjectPath_Click(object sender, EventArgs e) {
            CommonOpenFileDialog ofdOpen = new CommonOpenFileDialog();
            ofdOpen.IsFolderPicker = true;
            ofdOpen.Multiselect = false;

            ofdOpen.Title = "Please select the project path";

            if (ofdOpen.ShowDialog() == CommonFileDialogResult.Ok) {
                textBoxBrowse.Text = ofdOpen.FileName;
            }
        }

        private void buttonOK_Click(object sender, EventArgs e) {
                createProjectFile();
        }

        private void buttonCancel_Click(object sender, EventArgs e) {
            this.Close();
        }
        #endregion
    }
}
